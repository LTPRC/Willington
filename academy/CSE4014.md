# CSE401 - Spring - Spring Boot

返回[Bulletin](./bulletin.md)

返回[CSE401 - Spring](./CSE401.md)

[TOC]

## 基本介绍<img src="./icons/netease.gif" /><img src="./icons/ericsson.gif" />

Spring Boot是Spring开源组织下的子项目，通过Spring组件一站式解决方案来简化Spring应用的初始搭建以及开发过程。

- 项目可以通过命令java -jar xxx.jar以jar包的形式**独立运行**。

- 内嵌**servlet容器**，可以内嵌tomcat, jetty, 或者undertow，这样就可以不用war包形式部署项目。

- Spring提供了一系列starter pom来**简化**maven的**依赖**加载，当使用了spring-boot-starter-web时，会自动加载所需要的依赖包。

- Spring Boot会根据在类路径的jar包，类，为jar包中的类**自动配置**bean，这样会极大的减少配置的使用。

## Spring Boot实战

### 搭建工程<img src="./icons/mashibing.gif" />

登录https://start.spring.io/下载项目代码。

- 选择项目类型、所用语言、Spring Boot版本等信息。
- 选择必须的依赖（例如Spring Web）。

<img src="./images/CSE401027.png" />

### 入口类<img src="./icons/itcast.gif" />

Spring Boot的项目一般都会有名称以Application结尾的入口类，入口类中会有main方法，这是一个标准的Java应用程序的入口方法。

```java
@SpringBootApplication
@ComponentScan("com.github.ltprc")
public class SpringBootProjectApplication {
    public static void main(String[] args) {
        SpringApplication.run(SpringBootProjectApplication.class, args);
    }
}
```

**@SpringBootApplication**注解是Spring Boot的核心注解，它其实是一个组合注解。

在Spring Boot项目中推荐使用@ SpringBootConfiguration替代@Configuration

```java
@Target(ElementType.TYPE)
@Retention(RetentionPolicy.RUNTIME)
@Documented
@Configuration
@Indexed
public @interface SpringBootConfiguration {
    //...
}
```

**@ComponentScan**注解默认扫描@SpringBootApplication所在类的同级目录以及它的子目录。

### 自动配置<img src="./icons/itcast.gif" />

**@EnableAutoConfiguration**注解会使Spring Boot根据项目中依赖的jar包启用自动配置：在进行SpringApplication对象实例化时，Spring Boot会加载META-INF/spring.factories文件，将该配置文件中的配置载入到Spring容器。

例如我们如果添加了spring-boot-starter-web的依赖，项目中就会引入SpringMVC的依赖，Spring Boot就会自动配置tomcat和SpringMVC.

关闭某一项自动配置的方法如下所示：

```java
@SpringBootApplication(exclude = {XXXConfiguration.class})
```

### 自定义Banner<img src="./icons/mashibing.gif" /><img src="./icons/itcast.gif" />

运行后打印如下日志。

```
  .   ____          _            __ _ _
 /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \
( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \
 \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
  '  |____| .__|_| |_|_| |_\__, | / / / /
 =========|_|==============|___/=/_/_/_/
 :: Spring Boot ::                (v2.5.0)

2021-05-24 16:12:01.442  INFO 17368 --- [           main] c.g.ltprc.SpringBootProjectApplication   : Starting SpringBootProjectApplication using Java 15.0.1 on DESKTOP-E2INRCP with PID 17368 (D:\workspace-spring-tool-suite-4-4.9.0.RELEASE\springbootproject\target\classes started by tuoli in D:\workspace-spring-tool-suite-4-4.9.0.RELEASE\springbootproject)
2021-05-24 16:12:01.446  INFO 17368 --- [           main] c.g.ltprc.SpringBootProjectApplication   : No active profile set, falling back to default profiles: default
2021-05-24 16:12:02.273  INFO 17368 --- [           main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8080 (http)
2021-05-24 16:12:02.287  INFO 17368 --- [           main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2021-05-24 16:12:02.287  INFO 17368 --- [           main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.46]
2021-05-24 16:12:02.363  INFO 17368 --- [           main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2021-05-24 16:12:02.363  INFO 17368 --- [           main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 853 ms
2021-05-24 16:12:02.698  INFO 17368 --- [           main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8080 (http) with context path ''
2021-05-24 16:12:02.706  INFO 17368 --- [           main] c.g.ltprc.SpringBootProjectApplication   : Started SpringBootProjectApplication in 1.66 seconds (JVM running for 2.625)
2021-05-24 16:12:02.707  INFO 17368 --- [           main] o.s.b.a.ApplicationAvailabilityBean      : Application availability state LivenessState changed to CORRECT
2021-05-24 16:12:02.708  INFO 17368 --- [           main] o.s.b.a.ApplicationAvailabilityBean      : Application availability state ReadinessState changed to ACCEPTING_TRAFFIC
```

Banner允许自定义。获取Banner图案可以通过http://patorjk.com/software/taag/生成，拷贝到一个文本文件中，并且将该文件命名为banner.txt然后将banner.txt拷贝到项目的resources目录中。

关闭Banner的方法如下所示：

```java
@SpringBootApplication
@ComponentScan("com.github.ltprc")
public class SpringBootProjectApplication {
    public static void main(String[] args) {
        SpringApplication app = new SpringApplication(SpringBootProjectApplication.class);
        app.setBannerMode(Banner.Mode.OFF);
        app.run(args);
    }
}
```

### 全局配置文件<img src="./icons/itcast.gif" /><img src="./icons/mashibing.gif" />

Spring Boot项目使用一个全局的配置文件application.properties或者是application.yml，一般放在resources目录下，也可以放在类路径下的/config下。

例如：

- 修改tomcat的端口为8080
- 修改进入DispatcherServlet的规则为：*.html

```
server.port=8080
server.servlet-path=*.html
```

仿造Spring MVC的形式，创建Controller类。

```java
@Controller
public class HelloController {
    @RequestMapping("/hello")
    @ResponseBody
    public String hello() {
        return "Hello";
    }
}
```

可以在对应的端口以匹配的地址访问到Controller里的方法：[http://localhost:8080/hello.html](http://localhost:8080/hello.html)

```
Hello
```

### Starter pom<img src="./icons/itcast.gif" />

只要使用应用场景所需要的starter pom就可以得到Spring Boot自动配置的Bean.

```xml
<dependencies>
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-web</artifactId>
    </dependency>
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-test</artifactId>
        <scope>test</scope>
    </dependency>
</dependencies>
```

Spring Boot提供了绝大多数场景的starter pom, 详见https://docs.spring.io/spring-boot/docs/current/reference/html/using.html#using.build-systems.starters

### XML配置文件<img src="./icons/itcast.gif" />

Spring Boot不提倡使用XML文件进行配置，但是如果必须使用的话可以参考如下方法：

```java
@ImportResource({"classpath:some-context.xml","classpath:another-context.xml"})
```

